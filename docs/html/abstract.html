<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="TA-Lib : Python wrapper for TA-Lib (http://ta-lib.org/)." />
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <title>TA-Lib</title>
  </head>

  <body>
    <div id="header_wrap" class="outer">
        <header class="inner">
            <a id="forkme_banner" href="https://github.com/mrjbq7/ta-lib">Browse TA-Lib on GitHub</a>
            <div class="clearfix">
                <ul id="menu" class="drop">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="doc_index.html">Documentation</a></li>
                </ul>
            </div>
            <br>
            <h1 id="project_title">TA-Lib</h1>
            <h2 id="project_tagline">Python wrapper for TA-Lib (http://ta-lib.org/).</h2>
            <section id="downloads">
                <a class="zip_download_link" href="https://github.com/mrjbq7/ta-lib/zipball/master">Download this project as a .zip file</a>
                <a class="tar_download_link" href="https://github.com/mrjbq7/ta-lib/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
        <section id="main_content" class="inner">

  <div class="page">
    
  <div class="previewPage">
    <div id="readme" class="announce md">
      <article class="markdown-body entry-content">
        <h2>
<a name="abstract-api-examples" class="anchor" href="#abstract-api-examples"><span class="mini-icon mini-icon-link"></span></a>Abstract API Examples</h2>

<p>TA-Lib also provides an abstract interface for calling functions. Our
wrapper for the abstract interface is somewhat different from the upstream
implementation. The abstract interface is designed to make the TA-Lib easily
introspectable and dynamically programmable. Of course Python allows for
these things too, but this helps do some of the heavy lifting for you, making
it much easier to for example add a TA-Lib indicator control panel to a
GUI charting program. It also unifies the interface for using and calling
functions making life easier on the developer.</p>

<p>If you're already familiar with using the function API, you should feel right
at home using the abstract API. Every function takes the same input, passed
as a dictionary of observed values:</p>

<div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="c"># note that all ndarrays must be the same length!</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'open'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="s">'high'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="s">'low'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="s">'close'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="s">'volume'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

<p>From this input data, let's again calculate a simple moving average (SMA),
this time with the abstract interface:</p>

<div class="highlight"><pre><span class="kn">from</span> <span class="nn">talib.abstract</span> <span class="kn">import</span> <span class="n">Function</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">'sma'</span><span class="p">,</span> <span class="n">input_arrays</span><span class="p">)</span><span class="o">.</span><span class="n">outputs</span>

<span class="c"># teaser:</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">'sma'</span><span class="p">)(</span><span class="n">input_arrays</span><span class="p">,</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="s">'close'</span><span class="p">)</span>
<span class="n">upper</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">'bbands'</span><span class="p">)(</span><span class="n">input_arrays</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">print</span> <span class="n">Function</span><span class="p">(</span><span class="s">'STOCH'</span><span class="p">)</span><span class="o">.</span><span class="n">info</span>
</pre></div>

<p>You'll notice a few things are different. The function is now a class,
initialized with any supported function name (case insensitive) and optionally
<code>input_arrays</code>. To run the TA function with our input data, we access the
<code>outputs</code> property. It wraps a method that ensures the results are always
valid so long as the <code>input_arrays</code> dict was already set. Speaking of which,
the SMA function only takes one input, and we gave it five!</p>

<p>Certain TA functions define which price series names they expect for input.
Others, like SMA, don't (we'll explain how to figure out which in a moment).
<code>Function</code> will use the closing prices by default on TA functions that take
one undefined input, or the high and the low prices for functions taking two.
We can override the default like so:</p>

<div class="highlight"><pre><span class="n">sma</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">'sma'</span><span class="p">,</span> <span class="n">input_arrays</span><span class="p">)</span>
<span class="n">sma</span><span class="o">.</span><span class="n">set_function_args</span><span class="p">(</span><span class="n">timeperiod</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="s">'open'</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">sma</span><span class="o">.</span><span class="n">outputs</span>
</pre></div>

<p>This works by using keyword arguments. For functions with one undefined input,
the keyword is <code>price</code>; for two they are <code>price0</code> and <code>price1</code>. That's a
lot of typing; let's introduce some shortcuts:</p>

<div class="highlight"><pre><span class="n">output</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">'sma'</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_arrays</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">'sma'</span><span class="p">)(</span><span class="n">input_arrays</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="s">'open'</span><span class="p">)</span>
</pre></div>

<p>The <code>run()</code> method is a shortcut to <code>outputs</code> that also optionally accepts
an <code>input_arrays</code> dict to use for calculating the function values. You can
also call the <code>Function</code> instance directly; this shortcut to <code>outputs</code>
allows setting both <code>input_arrays</code> and/or any function parameters and
keywords. These methods make up all the ways you can call the TA function and
get its values.</p>

<p><code>Function.outputs</code> returns either a single ndarray or a list of ndarrays,
depending on how many outputs the TA function has. This information can be
found through <code>Function.output_names</code> or <code>Function.info['outputs']</code>.</p>

<p><code>Function.info</code> is a very useful property. It returns a dict with almost
every detail of the current state of the <code>Function</code> instance:</p>

<div class="highlight"><pre><span class="k">print</span> <span class="n">Function</span><span class="p">(</span><span class="s">'stoch'</span><span class="p">)</span><span class="o">.</span><span class="n">info</span>
<span class="p">{</span>
  <span class="s">'name'</span><span class="p">:</span> <span class="s">'STOCH'</span><span class="p">,</span>
  <span class="s">'display_name'</span><span class="p">:</span> <span class="s">'Stochastic'</span><span class="p">,</span>
  <span class="s">'group'</span><span class="p">:</span> <span class="s">'Momentum Indicators'</span><span class="p">,</span>
  <span class="s">'input_names'</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">([</span>
    <span class="p">(</span><span class="s">'prices'</span><span class="p">,</span> <span class="p">[</span><span class="s">'high'</span><span class="p">,</span> <span class="s">'low'</span><span class="p">,</span> <span class="s">'close'</span><span class="p">]),</span>
  <span class="p">]),</span>
  <span class="s">'parameters'</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">([</span>
    <span class="p">(</span><span class="s">'fastk_period'</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'slowk_period'</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'slowk_matype'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'slowd_period'</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
    <span class="p">(</span><span class="s">'slowd_matype'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
  <span class="p">]),</span>
  <span class="s">'output_names'</span><span class="p">:</span> <span class="p">[</span><span class="s">'slowk'</span><span class="p">,</span> <span class="s">'slowd'</span><span class="p">],</span>
  <span class="s">'flags'</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>

<p>Take a look at the value of the <code>input_names</code> key. There's only one input
price variable, 'prices', and its value is a list of price series names.
This is one of those TA functions where TA-Lib defines which price series it
expects for input. Any time <code>input_names</code> is an OrderedDict with one key,
<code>prices</code>, and a list for a value, it means TA-Lib defined the expected price
series names. You can override these just the same as undefined inputs, just
make sure to use a list with the correct number of price series names! (it
varies across functions)</p>

<p>You can also use <code>Function.input_names</code> to get/set the price series names,
and <code>Function.parameters</code> to get/set the function parameters. Let's expand
on the other ways to set TA function arguments:</p>

<div class="highlight"><pre><span class="kn">from</span> <span class="nn">talib</span> <span class="kn">import</span> <span class="n">MA_Type</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">'sma'</span><span class="p">)(</span><span class="n">input_arrays</span><span class="p">,</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="s">'high'</span><span class="p">)</span>

<span class="n">upper</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">'bbands'</span><span class="p">)(</span><span class="n">input_arrays</span><span class="p">,</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">matype</span><span class="o">=</span><span class="n">MA_Type</span><span class="o">.</span><span class="n">EMA</span><span class="p">)</span>

<span class="n">stoch</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">'stoch'</span><span class="p">,</span> <span class="n">input_arrays</span><span class="p">)</span>
<span class="n">stoch</span><span class="o">.</span><span class="n">set_function_args</span><span class="p">(</span><span class="n">slowd_period</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">slowk</span><span class="p">,</span> <span class="n">slowd</span> <span class="o">=</span> <span class="n">stoch</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">fastd_period</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c"># 15 == fastk_period specified positionally</span>
</pre></div>

<p><code>input_arrays</code> must be passed as a positional argument (or left out
entirely). TA function parameters can be passed as positional or keyword
arguments. Input price series names must be passed as keyword arguments (or
left out entirely). In fact, the <code>__call__</code> method of <code>Function</code> simply
calls <code>set_function_args()</code>.</p>

<p>For your convenience, we create <code>Function</code> wrappers for all of the available
TA-Lib functions:</p>

<div class="highlight"><pre><span class="kn">from</span> <span class="nn">talib.abstract</span> <span class="kn">import</span> <span class="n">SMA</span><span class="p">,</span> <span class="n">BBANDS</span><span class="p">,</span> <span class="n">STOCH</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">SMA</span><span class="p">(</span><span class="n">input_arrays</span><span class="p">)</span>

<span class="n">upper</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">BBANDS</span><span class="p">(</span><span class="n">input_arrays</span><span class="p">,</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">slowk</span><span class="p">,</span> <span class="n">slowd</span> <span class="o">=</span> <span class="n">STOCH</span><span class="p">(</span><span class="n">input_arrays</span><span class="p">,</span> <span class="n">fastk_period</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">fastd_period</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
      </article>
    </div>
  </div>
  
  <div>&nbsp;</div>

  </div>
  
        </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">TA-Lib written by <a href="https://github.com/mrjbq7">mrjbq7</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

  </body>
</html>
